---
title: "Effects of ISTDP on Treatment-Resistant Depression"
subtitle: "A Reanalysis Examining Mechanisms of Change"
author: "Robert Johansson & Peter Lilliengren"
institute: "Department of Psychology, Stockholm University"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: [default, default-fonts, custom.css]
    lib_dir: libs
    self_contained: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
      slideNumberFormat: '%current%'
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding,
  output_file = 'index.html') })
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.retina = 3,
  fig.width = 6,
  fig.height = 3.5,
  fig.path = "figures/",
  cache = FALSE,
  dev = "png",
  dpi = 96,
  out.width = "85%"
)

library(haven)
library(dplyr)
library(tidyr)
library(ggplot2)
library(lme4)
library(lmerTest)
library(emmeans)
library(effsize)
library(knitr)

theme_set(theme_minimal(base_size = 12))
```

```{r load-data, include=FALSE}
data <- read_sav("../../data/RCT Dataset ISTDP vs. Waitlist for Treatment-Resistant Depression.sav")

data <- data %>%
  mutate(
    Time = as_factor(Time),
    Tx_condition = as_factor(Tx_condition),
    id = factor(id),
    Time_numeric = case_when(
      Time == "Baseline" ~ 0,
      Time == "Post-treatment" ~ 1,
      Time == "Follow-up" ~ 2
    )
  )

baseline <- data %>% filter(Time == "Baseline")
data_clean <- data %>% filter(!is.na(Depression))
```

```{r compute-effects, include=FALSE}
# Between-group effect sizes at each time point
effect_sizes <- data.frame()
for (tp in c("Baseline", "Post-treatment", "Follow-up")) {
  df_time <- data_clean %>% filter(Time == tp)
  ctrl <- df_time %>% filter(Tx_condition == "Control") %>% pull(Depression)
  istdp <- df_time %>% filter(Tx_condition == "ISTDP") %>% pull(Depression)
  d <- cohen.d(istdp, ctrl)
  effect_sizes <- rbind(effect_sizes, data.frame(
    Time = tp,
    d = -d$estimate,
    ci_lo = -d$conf.int[2],
    ci_hi = -d$conf.int[1]
  ))
}

# Process measure effect sizes at follow-up
process_vars <- c("WAI_RRC", "PANAS_NA", "Distress", "Suppression_of_aggression")
process_labels <- c("Emotional Repression", "Negative Affect", "Distress", "Suppression of Aggression")
process_es <- data.frame()
for (i in seq_along(process_vars)) {
  df_fu <- data %>% filter(Time == "Follow-up")
  ctrl <- na.omit(df_fu %>% filter(Tx_condition == "Control") %>% pull(!!sym(process_vars[i])))
  istdp <- na.omit(df_fu %>% filter(Tx_condition == "ISTDP") %>% pull(!!sym(process_vars[i])))
  d <- cohen.d(istdp, ctrl)
  process_es <- rbind(process_es, data.frame(
    measure = process_labels[i],
    d = -d$estimate
  ))
}

# Within-ISTDP correlations (baseline to follow-up change)
change_data <- data %>%
  filter(Tx_condition == "ISTDP") %>%
  dplyr::select(id, Time, Depression, WAI_RRC, PANAS_NA, Distress) %>%
  pivot_wider(names_from = Time, values_from = c(Depression, WAI_RRC, PANAS_NA, Distress),
              names_sep = "_") %>%
  rename_with(~gsub(" ", "", .x)) %>%
  rename_with(~gsub("-", "_", .x)) %>%
  mutate(
    dep_change = Depression_Follow_up - Depression_Baseline,
    rrc_change = WAI_RRC_Follow_up - WAI_RRC_Baseline,
    na_change = PANAS_NA_Follow_up - PANAS_NA_Baseline,
    dist_change = Distress_Follow_up - Distress_Baseline
  )

cor_rrc <- cor(change_data$dep_change, change_data$rrc_change, use = "complete.obs")
cor_na <- cor(change_data$dep_change, change_data$na_change, use = "complete.obs")
cor_dist <- cor(change_data$dep_change, change_data$dist_change, use = "complete.obs")
```

```{r mediation, include=FALSE}
library(mediation)

data_wide_med <- data %>%
  dplyr::select(id, Tx_condition, Time, Depression, PANAS_NA, WAI_RRC, Distress) %>%
  pivot_wider(names_from = Time, values_from = c(Depression, PANAS_NA, WAI_RRC, Distress),
              names_sep = "_") %>%
  rename_with(~gsub(" ", "", .x)) %>%
  rename_with(~gsub("-", "_", .x)) %>%
  mutate(
    treatment = ifelse(Tx_condition == "ISTDP", 1, 0),
    PANAS_change = PANAS_NA_Post_treatment - PANAS_NA_Baseline,
    WAI_RRC_change = WAI_RRC_Post_treatment - WAI_RRC_Baseline,
    Distress_change = Distress_Post_treatment - Distress_Baseline,
    Distress_noDep_BL = Distress_Baseline - Depression_Baseline,
    Distress_noDep_Post = Distress_Post_treatment - Depression_Post_treatment,
    Distress_noDep_change = Distress_noDep_Post - Distress_noDep_BL
  ) %>%
  filter(complete.cases(treatment, Depression_Baseline, Depression_Follow_up,
                       PANAS_change, WAI_RRC_change, Distress_change))

run_med <- function(data, mediator_var) {
  data$M <- data[[mediator_var]]
  med_m <- lm(M ~ treatment, data = data)
  out_m <- lm(Depression_Follow_up ~ M + treatment + Depression_Baseline, data = data)
  set.seed(2025)
  res <- mediate(med_m, out_m, treat = "treatment", mediator = "M",
                 boot = TRUE, sims = 5000, boot.ci.type = "bca")
  list(indirect = res$d0, p = res$d0.p, prop = res$n0)
}

med_dist <- run_med(data_wide_med, "Distress_change")
med_rrc <- run_med(data_wide_med, "WAI_RRC_change")
med_na <- run_med(data_wide_med, "PANAS_change")
med_dist_noDep <- run_med(data_wide_med, "Distress_noDep_change")
```

---
class: inverse, center, middle

# Introduction

---

# Treatment-Resistant Depression

.pull-left[
**Clinical Challenge:**
- ~30% of depressed patients don't respond to first-line treatments
- Cumulative failure rates increase with each trial
- Substantial burden on patients and healthcare systems

**ISTDP as a Promising Alternative:**
- Brief psychodynamic therapy (10--40 sessions, typically once per week)
- Targets emotional avoidance and defensive functioning
- Growing evidence base for depression, including TRD
]

.pull-right[
**Proposed Sequential Mechanism:**

.center[
Reduce Repression

&darr;

Facilitate Emotional Experiencing

&darr;

Reduce Depression
]
]

---

# The Original Study & Our Research Questions

**Heshmati, Wienicke, & Driessen (2023):**
- RCT: *N* = 86 with treatment-resistant depression (Iran)
- ISTDP (20 sessions / 10 weeks) vs. Waitlist
- Very large effects on depression, but mechanisms untested

--

**Our Four Research Questions:**

1. How large and durable are ISTDP's effects on depression?

2. Does ISTDP change proposed process measures?

3. Do process changes **mediate** depression improvement?

4. Do process changes **precede** depression changes?

---
class: inverse, center, middle

# Methods

---

# Design and Analysis

.pull-left[
**Sample:** *N* = 86 (43 ISTDP, 43 Waitlist); 62% female; ages 18--60

**Attrition:** 12.8% (7 ISTDP, 4 Waitlist); handled via REML

**Measures:**
- Primary: Depression (WAI Depression subscale, 7--35)
- Process: Emotional Repression (WAI-RRC), Negative Affect (PANAS-NA), Distress (WAI Distress)
]

.pull-right[
**Analyses:**
- Linear mixed-effects models (random intercepts)
- Bootstrap mediation (5,000 resamples, BCa CIs)
- Cross-lagged panel analyses (standardized coefficients)
- Sensitivity: Distress without Depression subscale, therapist effects

**Open Science:** All data (OSF) and code (GitHub) publicly available; 129 automated validation tests
]

---
class: inverse, center, middle

# Results

---
class: inverse, center, middle

# RQ1
## How large and durable are ISTDP's effects on depression?

---

# RQ1: Depression Trajectories

```{r trajectories, fig.width=8, fig.height=4.5, out.width="80%"}
summary_stats <- data_clean %>%
  group_by(Tx_condition, Time_numeric, Time) %>%
  summarise(
    n = n(), mean = mean(Depression, na.rm = TRUE),
    se = sd(Depression, na.rm = TRUE) / sqrt(n),
    ci = 1.96 * se, .groups = "drop"
  )

colors <- c("Control" = "#2E86AB", "ISTDP" = "#A23B72")

ggplot(summary_stats, aes(x = Time_numeric, y = mean, color = Tx_condition)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  geom_errorbar(aes(ymin = mean - ci, ymax = mean + ci), width = 0.1) +
  scale_color_manual(values = colors) +
  scale_x_continuous(breaks = c(0, 1, 2),
                    labels = c("Baseline", "Post-treatment", "3-mo Follow-up")) +
  labs(x = NULL, y = "Depression Score (WAI)", color = "Group") +
  theme_minimal(base_size = 12) +
  theme(legend.position = c(0.85, 0.85),
        legend.background = element_rect(fill = "white", color = "gray80"))
```

---

# RQ1: Effect Sizes

**Between-group effect sizes (Cohen's *d*):**

| Time Point | *d* | 95% CI |
|-----------|-----|--------|
| Baseline | `r sprintf("%.2f", effect_sizes$d[1])` | [`r sprintf("%.2f", effect_sizes$ci_lo[1])`, `r sprintf("%.2f", effect_sizes$ci_hi[1])`] |
| Post-treatment | `r sprintf("%.2f", effect_sizes$d[2])` | [`r sprintf("%.2f", effect_sizes$ci_lo[2])`, `r sprintf("%.2f", effect_sizes$ci_hi[2])`] |
| **Follow-up** | **`r sprintf("%.2f", effect_sizes$d[3])`** | [`r sprintf("%.2f", effect_sizes$ci_lo[3])`, `r sprintf("%.2f", effect_sizes$ci_hi[3])`] |

--

- Effects **increase over time** rather than diminishing
- Continued improvement after treatment ended (*p* < .001)
- Very large effects relative to waitlist control

---
class: inverse, center, middle

# RQ2
## Does ISTDP change proposed process measures?

---

# RQ2: Process Measure Effects at Follow-Up

.pull-left[
**All proposed mechanisms showed very large effects:**

| Process Measure | Cohen's *d* |
|----------------|-------------|
| Emotional Repression (WAI-RRC) | `r sprintf("%.2f", process_es$d[process_es$measure == "Emotional Repression"])` |
| Negative Affect (PANAS-NA) | `r sprintf("%.2f", process_es$d[process_es$measure == "Negative Affect"])` |
| Distress (WAI) | `r sprintf("%.2f", process_es$d[process_es$measure == "Distress"])` |
| Suppression of Aggression | `r sprintf("%.2f", process_es$d[process_es$measure == "Suppression of Aggression"])` |
]

.pull-right[
**Within-ISTDP correlations with depression change:**

- Distress: *r* = `r sprintf("%.2f", cor_dist)` (but includes Depression subscale)
- Emotional Repression: *r* = `r sprintf("%.2f", cor_rrc)`
- Negative Affect: *r* = `r sprintf("%.2f", cor_na)`
]

---
class: inverse, center, middle

# RQ3
## Do process changes mediate depression improvement?

---

# RQ3: Mediation Results

| Mediator | Indirect Effect | *p* | Mediated? |
|----------|:-:|:-:|:-:|
| Distress | `r sprintf("%.2f", med_dist$indirect)` | `r sprintf("%.3f", med_dist$p)` | Significant (54%) |
| Emotional Repression | `r sprintf("%.2f", med_rrc$indirect)` | `r sprintf("%.3f", med_rrc$p)` | No |
| Negative Affect | `r sprintf("%.2f", med_na$indirect)` | `r sprintf("%.3f", med_na$p)` | No |

--

**But:** Distress includes the Depression subscale &rarr; circular!

--

**Sensitivity analysis** (removing Depression from Distress):

- ACME = `r sprintf("%.2f", med_dist_noDep$indirect)`, *p* = `r sprintf("%.3f", med_dist_noDep$p)` &rarr; **Not significant**

--

.center[
### No genuine mediation for any process measure
]

---
class: inverse, center, middle

# RQ4
## Do process changes precede depression changes?

---

# RQ4: Temporal Precedence

**Cross-lagged panel analyses (standardized &beta;):**

No evidence that process changes precede depression changes:

| Process Measure | Process &rarr; Depression | Depression &rarr; Process |
|:--|:-:|:-:|
| Emotional Repression | n.s. | n.s. |
| Negative Affect | n.s. | n.s. |
| Distress | n.s. | n.s. |

--

**Interpretation:**
- Process measures and depression change **concurrently**, not sequentially
- No evidence for the theorized causal chain
- Consistent with broad, simultaneous therapeutic change

---
class: inverse, center, middle

# Discussion

---

# The Mediation Puzzle

**The paradox:** ISTDP produces large effects on both depression and all process measures, yet process changes don't mediate depression improvement.

--

**Four possible explanations:**

1. **Measurement timing** -- 3 time points too coarse to capture session-level dynamics; session-by-session process coding has shown effects (Town et al., 2022)

2. **Self-report limitations** -- Unconscious processes may not be capturable via questionnaires; observer-rated "unlocking" *did* mediate outcomes (Johansson et al., 2024)

3. **Defensive restructuring** -- Patients may shift defensive organization (e.g., repression &rarr; isolation of affect) without full "unlocking" (Abbass, 2015)

4. **Multiple pathways** -- Different psychodiagnostic groups (resistant, repressive, fragile) may change through different mechanisms (Abbass, 2015; Johansson et al., 2014)

---

# Conclusions

.pull-left[
### ISTDP is effective

- Very large, durable effects on TRD (*d* = `r sprintf("%.2f", effect_sizes$d[3])` at follow-up)
- Effects increase after treatment ends
- All proposed process measures change substantially
]

.pull-right[
### But mechanisms remain unclear

- No mediation by emotional repression or negative affect
- Distress mediation due to construct overlap, not genuine mechanism
- Concurrent rather than sequential change
]

--

.center[
### Understanding *how* psychotherapy works requires finer temporal measurement and observational methods
]

---

# Thank You

.pull-left[
**Questions?**

Robert Johansson & Peter Lilliengren

robert.johansson@psychology.su.se

Department of Psychology, Stockholm University
]

.pull-right[
**Resources:**

- GitHub: github.com/robert-johansson/heshmati-reanalysis
- Data: doi.org/10.17605/OSF.IO/75PU8
- Original Paper: Heshmati et al. (2023), *Psychotherapy*
]
